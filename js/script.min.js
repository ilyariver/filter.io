"use strict";let App={},flatsFilter={};const roomsFilterButtons=document.querySelector(".js-rooms-filter-btns"),pageMainContent=document.querySelector(".js-main"),flat=document.querySelector(".js-flat"),buttonUp=document.querySelector(".js-button-up"),wrapListFlats=document.querySelector(".js-flats-list"),resetButton=document.querySelector(".js-reset-button"),forSearchMinMaxFlats=1e4,breakPointMediumSize=768,numberOfCards=20;let count=0,countElse=1,startState=4,div=document.createElement("div");div.style.overflowY="scroll",div.style.width="100%",div.style.height="50px",document.body.append(div);let scrollWidth=div.offsetWidth-div.clientWidth;div.remove(),renderCreateTitle(),getResponse(startState,!0),window.addEventListener("resize",(function(){renderCreateTitle()})),roomsFilterButtons.addEventListener("click",(function(t){flatsFilter.rooms=[];const e=t.target.closest(".js-number-of-rooms");if(!e)return;e.classList.toggle("active");document.querySelectorAll(".js-number-of-rooms").forEach(t=>{t.classList.contains("active")&&flatsFilter.rooms.push(+t.getAttribute("id"))}),getResponse(App.stateView,!1,"roomsHandler",App.filterRender())})),resetButton.addEventListener("click",(function(){let t=$(".js-range-slider-input-cost").data("ionRangeSlider");const e=document.querySelector(".js-watch-more-btn");document.querySelectorAll(".js-number-of-rooms").forEach(t=>t.classList.remove("active")),t.reset(),getResponse(startState,!0,"reset"),count=0,App.rangeCost={},App.rangeArea={},App.rooms=[],e||createButtonWatchMore(startState)})),window.addEventListener("scroll",(function(t){pageYOffset>=window.innerHeight/2?buttonUp.classList.add("show"):buttonUp.classList.remove("show")})),buttonUp.addEventListener("click",(function(){pageMainContent.scrollIntoView({behavior:"smooth"})}));const flatHtmlTemplate=t=>`<li class="flats-list__item js-flat">\n\t\t<div class="flats-list__info">\n\t\t\t<h2 class="flats-list__title">${t.rooms}-комнатная № ${t.apartment}</h2>\n\t\t\t<h2 class="flats-list__title">${t.id}</h2>\n\t\t\t<div class="flats-list__options">\n\t\t\t\t<div class="flats-list__option flats-block__width">${t.options.area} <span>м<sup>2</sup></span></div>\n\t\t\t\t<div class="flats-list__option flats-block__width">${t.options.stage} <span>из 17 <span>этаж</span></span></div>\n\t\t\t\t<div class="flats-list__option flats-block__width">${reformatNumbers(t.options.cost)} <span>₽</span></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<picture>\n\t\t\t<source srcset="${t.image}" type="image/webp">\n\t\t\t<img src="${t.image}" alt="${t.name}" class="flats-list__image">\n\t\t</picture>\n</li>\n`;function reformatNumbers(t){return t.toLocaleString("ru-RU")}async function getResponse(t=4,e=!1,s=null,n=null){const o=document.querySelector(".js-watch-more-btn"),l=document.querySelectorAll(".js-number-of-rooms"),a=[],i=[];let r=0;const c=await fetch("http://localhost:3005/list");if("slide"!==s&&App.f(),c.ok){const p=await c.json(),d=p.data,u=t=>d.reduce((e,s)=>Number.parseInt(e.options[t])<Number.parseInt(s.options[t])?e:s),m=t=>d.reduce((e,s)=>Number.parseInt(e.options[t])>Number.parseInt(s.options[t])?e:s);o&&t>=d.length&&o.remove();const f=u("cost").options.cost,_=m("cost").options.cost,v=u("area").options.area,g=m("area").options.area;if(e){let t=$(".js-range-slider-input-cost").data("ionRangeSlider"),e=$(".js-range-slider-input-area").data("ionRangeSlider");t.update({min:f-1e4,max:_+1e4,from:f-1e4,to:_+1e4}),e.update({min:Number.parseInt(v),max:Number.parseInt(g),from:Number.parseInt(v),to:Number.parseInt(g)})}l.forEach(t=>a.push(+t.querySelector("span").textContent)),d.forEach(t=>i.push(t.rooms)),a.filter(t=>{if(!i.includes(t)){const e=document.getElementById(t);e.setAttribute("disabled",!0),e.classList.remove("hovered"),e.style.cursor="auto"}}),window.addEventListener("resize",(function(){pageMainContent.style.width="",pageMainContent.style.width=pageMainContent.clientWidth+"px"})),1!==countElse||s||(countElse++,await createButtonWatchMore(t)),getScroll("Height")&&s||(pageMainContent.style.width="",pageMainContent.style.width=pageMainContent.clientWidth-scrollWidth+"px"),r=p.data.length,"clickFilter"!==s&&(App.contentSplice=p.data.splice(0,t)),document.querySelector(".js-top-filter-block").addEventListener("click",(function(t){const e=t.target;var s;if(e.closest(".js-top-filter-block")&&(document.querySelectorAll(".filters-list__arrow-btn").forEach(t=>t.style.color="#0b1739"),e.closest(".filters-list__arrow-btn").style.color="#3EB57C",e.closest(".js-btn-top-cost"))){App.contentSplice.sort((s="options",(t,e)=>t[s].cost>e[s].cost?1:-1)),App.contentSplice=App.contentSplice.filter(t=>App.contentSplice.map(t=>t.options.cost).includes(t.options.cost)),getResponse(App.stateView,!1,"clickFilter")}})),App.filterRender=(t="rangeCost",e="cost")=>{let s="",n=flatsFilter.rooms&&flatsFilter.rooms.length;if(n&&(s=App.contentSplice.filter(t=>flatsFilter.rooms.includes(t.rooms))),flatsFilter[t]){s=(n?s:App.contentSplice).filter(s=>flatsFilter[t]&&Number.parseInt(s.options[e])>=flatsFilter[t].from&&Number.parseInt(s.options[e])<=flatsFilter[t].to)}const o="rangeCost"===t?flatsFilter.rangeArea:flatsFilter.rangeCost,l="rangeCost"===t?"area":"cost";return o&&s.length?s.filter(t=>o&&Number.parseInt(t.options[l])>=o.from&&Number.parseInt(t.options[l])<=o.to):s},console.log(n);document.querySelector(".js-flat");let b=(n||App.contentSplice).map(t=>flatHtmlTemplate(t));console.log(b),setTimeout(()=>{document.querySelectorAll(".js-skeletons").forEach(t=>t.remove()),wrapListFlats.innerHTML=b.join(""),function(){const t=document.querySelectorAll(".js-flat"),e=document.querySelector(".js-notice-of-empty");t.length||e||($("<p/>",{class:"notice-of-empty js-notice-of-empty",text:"Ой, таких квартир пока нет..."}).appendTo(".js-flats-block"),countElse=1);t.length&&e&&e.remove()}(),function(){const t=document.querySelectorAll(".js-flat"),e=document.querySelector(".js-watch-more-btn");if(!e)return;t.length===r&&(e.remove(),countElse=1)}()},500),setTimeout(()=>{},500)}else alert("Ошибка: "+c.status)}function getScroll(t){const e=document,s=e.body,n=e.documentElement,o="client"+t;return t="scroll"+t,/CSS/.test(e.compatMode)?n[o]<n[t]:s[o]<s[t]}function createButtonWatchMore(t){$("<button/>",{type:"button",class:"watch-more-btn js-watch-more-btn",text:"Загрузить еще"}).appendTo(".js-section-flats-container"),document.querySelector(".js-watch-more-btn").addEventListener("click",(function(){count+=20+t,App.stateView=count,getResponse(count,!1,"handler",App.filterRender()),t=0}))}function renderCreateTitle(){if(window.innerWidth>=768)return createTitle(".js-flats-block");createTitle(".js-section-flats-container")}function createTitle(t){document.getElementById("main-title").remove(),$("<div/>",{id:"main-title",class:"section-flats__title js-flats-block-title",text:"Квартиры"}).prependTo(t)}App.f=function(){const t=document.querySelector(".js-notice-of-empty");t&&t.remove(),wrapListFlats.innerHTML="",wrapListFlats.insertAdjacentHTML("beforeend",'\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t\t\t\t\t<div class="skeletons__body">\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="skeletons__img"></div>\n\t\t\t\t\t</li>\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t\t\t\t\t<div class="skeletons__body">\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="skeletons__img"></div>\n\t\t\t\t\t</li>\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t\t\t\t\t<div class="skeletons__body">\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="skeletons__img"></div>\n\t\t\t\t\t</li>\n\t\t<li class="flats-list__skeletons skeletons js-skeletons">\n\t\t\t\t\t\t\t<div class="skeletons__body">\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t\t\t<span class="skeletons__text"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="skeletons__img"></div>\n\t\t\t\t\t</li>')};